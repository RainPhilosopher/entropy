/**
* entropy.js 0.2.0 - framework for making games and not only games in entity system manner - build: 2015-02-22
*
* @author       Tymoteusz Dzienniak <tymoteusz.dzienniak@outlook.com>
* @license      {@link https://github.com/RainPhilosopher/Entropy/blob/master/LICENSE|MIT License}
*/

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Entropy=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b){void 0===a?a=31:"string"==typeof a&&(a=a.length),b=1!==b?0:2147483647;for(var d=31,e=Math.ceil(a/d),f=e;f--;)this[f]=b;if("string"==typeof a)for(f=a.length;f--;)this.set(f,a.charAt(f));var g=function(a,b,c,f){if(void 0===c&&(void 0===b?(b=0,c=e*d-1):c=b),0>b||b>c||c>=d*e)return null;for(var g=e;g--;){var h=Math.max(b,g*d),i=Math.min(c,d-1+d*g);if(i>=h){var j=~(1<<1+i%d)+(1<<h%d);0===f?a[g]&=j:a[g]^=~j}}return a};this.size=d*e,this.length=e,this.and=function(a){if(a instanceof c)for(var b=e;b--;)this[b]&=a[b]||0;return this},this.or=function(a){if(a instanceof c)for(var b=e;b--;)this[b]|=a[b]||0;return this},this.nand=function(a){if(a instanceof c)for(var b=e;b--;)this[b]=~(this[b]&(a[b]||0));return this},this.nor=function(a){if(a instanceof c)for(var b=e;b--;)this[b]=~(this[b]|(a[b]||0));return this},this.not=function(){for(var a=e;a--;)this[a]=~this[a];return this},this.xor=function(a){if(a instanceof c)for(var b=e;b--;)this[b]=this[b]^(a[b]||0);return this},this.equals=function(a){if(!(a instanceof c))return!1;if(a.length!==e)return!1;for(var b=e;b--;)if(a[b]!==this[b])return!1;return!0},this.subsetOf=function(a){if(!(a instanceof c))return!1;if(a.length!==e)return!1;for(var b=e;b--;)if((a[b]&this[b])!==this[b])return!1;return!0},this.clone=function(){for(var a=new c(this.size),b=e;b--;)a[b]=this[b];return a},this.isEmpty=function(){for(var a=e;a--;)if(0!==this[a])return!1;return!0},this.toString=function(a){for(var b="",c=e;c--;){e>c+1&&void 0!==a&&(b+=String(a));var f=this[c].toString(2);b+=new Array(1+d-f.length).join("0"),b+=f}return b},this.cardinality=function(){for(var a,b=0,c=e;c--;)for(a=this[c];a;a&=a-1,b++);return b},this.msb=function(){for(var a=e;a--;){var b=this[a],c=0;if(b){for(;b>>=1;c++);return d*a+c}}return 0},this.set=function(a,b){if(void 0===b&&(b=1),a>=0&&d*e>a){var c=a/d|0;return this[c]^=1<<a%d&(-(1&b)^this[c]),this}return null},this.setRange=function(a,b,c){if(b>=a&&a>=0&&d*e>b){if("string"==typeof c){if(b-a!==c.length)return null;for(var f=0;f<c.length;f++)this.set(f+a,c.charAt(c.length-f-1))}else{void 0===c&&(c=1);for(var f=a;b>=f;f++)this.set(f,c)}return this}return null},this.get=function(a){return a>=0&&d*e>a?this[a/d|0]>>a%d&1:null},this.getRange=function(a,b){if(b>=a&&a>=0&&d*e>b){for(var f=new c(b-a+1),g=a;b>=g;g++)f.set(g-a,this.get(g));return f}return null},this.clear=function(a,b){return g(this,a,b,0)},this.flip=function(a,b){return g(this,a,b,1)}}"undefined"!=typeof b&&b.exports&&(b.exports.BitSet=c)},{}],2:[function(b,c){!function(b){"use strict";function d(a,b){var c;R.object(a),R.object(b);for(c in b)if(b.hasOwnProperty(c)){if(a.hasOwnProperty(c)===!1||typeof a[c]!=typeof b[c])return!1;if(g(a[c])&&d(a[c],b[c])===!1)return!1}return!0}function e(a,b){return a&&n(b)&&a instanceof b?!0:!1}function f(a){return g(a)&&0===Object.keys(a).length}function g(a){return h(a)&&"[object Object]"===Object.prototype.toString.call(a)}function h(a){return!i(a)&&!j(a)}function i(a){return void 0===a}function j(a){return null===a}function k(a,b){return R.not.undefined(b),h(a)&&a.length===b}function l(a){return Array.isArray(a)}function m(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())}function n(a){return"function"==typeof a}function o(a){return p(a)&&/^(https?:)?\/\/([\w-\.~:@]+)(\/[\w-\.~\/\?#\[\]&\(\)\*\+,;=%]*)?$/.test(a)}function p(a){return q(a)&&""!==a}function q(a){return"string"==typeof a}function r(a){return t(a)&&!s(a)}function s(a){return w(a)&&a%2===0}function t(a){return w(a)&&a%1===0}function u(a){return w(a)&&a>0}function v(a){return w(a)&&0>a}function w(a){return"number"==typeof a&&isNaN(a)===!1&&a!==Number.POSITIVE_INFINITY&&a!==Number.NEGATIVE_INFINITY}function x(a){return a===!1||a===!0}function y(a,b){return R.array(a),n(b)?a.map(function(a){return b(a)}):(R.array(b),R.length(a,b.length),a.map(function(a,c){return b[c](a)}))}function z(a,b){var c,d={};return R.object(a),R.object(b),c=Object.keys(b),R.length(Object.keys(a),c.length),c.forEach(function(c){var e=b[c];n(e)?d[c]=e(a[c]):g(e)&&(d[c]=z(a[c],e))}),d}function A(a){return l(a)?B(a,!1):(R.object(a),C(a,!1))}function B(a,b){var c;for(c=0;c<a.length;c+=1)if(a[c]===b)return b;return!b}function C(a,b){var c,d;for(c in a)if(a.hasOwnProperty(c)){if(d=a[c],g(d)&&C(d,b)===b)return b;if(d===b)return b}return!b}function D(a){return l(a)?B(a,!0):(R.object(a),C(a,!0))}function E(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a}function F(a,b){return function(){G(a,arguments,b)}}function G(a,b,c){var d;if(!a.apply(null,b))throw d=b[b.length-1],new Error(p(d)?d:c)}function H(a,b){return function(){function c(a,b){return a[b]=function(){if(d&&!P[b].apply(null,arguments))throw d},a}var d;try{G(a,arguments,b)}catch(e){d=e}return{or:Object.keys(P).reduce(c,{})}}}function I(a){return function(){return!a.apply(null,arguments)}}function J(a){return function(){return h(arguments[0])?a.apply(null,arguments):!0}}function K(a){function b(){return!0}return function(){function c(a,c){return a[c]=d?b:P[c],a}var d=a.apply(null,arguments);return{or:Object.keys(P).reduce(c,{})}}}function L(a){return M(a,P)}function M(a,b){var c={};return Object.keys(b).forEach(function(d){c[d]=a(b[d],O[d])}),c}function N(d){"function"==typeof a&&a.amd?a(function(){return d}):"undefined"!=typeof c&&null!==c&&c.exports?c.exports=d:b.check=d}var O,P,Q,R,S,T,U;O={like:"Invalid type",instance:"Invalid type",emptyObject:"Invalid object",object:"Invalid object",assigned:"Invalid value",undefined:"Invalid value","null":"Invalid value",length:"Invalid length",array:"Invalid array",date:"Invalid date",fn:"Invalid function",webUrl:"Invalid URL",unemptyString:"Invalid string",string:"Invalid string",odd:"Invalid number",even:"Invalid number",positive:"Invalid number",negative:"Invalid number",integer:"Invalid number",number:"Invalid number","boolean":"Invalid boolean"},P={like:d,instance:e,emptyObject:f,object:g,assigned:h,undefined:i,"null":j,length:k,array:l,date:m,"function":n,webUrl:o,unemptyString:p,string:q,odd:r,even:s,positive:u,negative:v,integer:t,number:w,"boolean":x},Q={apply:y,map:z,all:A,any:D},Q=E(Q,P),R=L(F),S=L(I),T=L(J),U=L(K),R.not=M(F,S),R.maybe=M(F,T),R.either=M(H,P),N(E(Q,{assert:R,not:S,maybe:T,either:U}))}(this)},{}],3:[function(b,c,d){!function(b,e){"function"==typeof a&&a.amd?a([],e):"object"==typeof d?c.exports=e():b.Inverse=e()}(this,function(){"use strict";var a=function(){this._boundCallbacks={},this._singletonCallbacks={},this._instantiatedSingletons={},this._registeredObjects={}};return a.prototype.make=function(a){if(this._registeredObjects.hasOwnProperty(a))return this._registeredObjects[a];var b=Array.prototype.slice.call(arguments,1);return this._singletonCallbacks.hasOwnProperty(a)?(this._instantiatedSingletons.hasOwnProperty(a)||(this._instantiatedSingletons[a]=this._singletonCallbacks[a].apply(this,b)),this._instantiatedSingletons[a]):this._boundCallbacks.hasOwnProperty(a)?this._boundCallbacks[a].apply(this,b):null},a.prototype.bind=function(a,b){this._boundCallbacks[a]=b},a.prototype.singleton=function(a,b){this._singletonCallbacks[a]=b},a.prototype.register=function(a,b){this._registeredObjects[a]=b},a})},{}],4:[function(a,b){b.exports=a("./lib/extend")},{"./lib/extend":5}],5:[function(a,b){function c(){var a,b,e,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"==typeof i||d.fn(i)||(i={});k>j;j++)if(a=arguments[j],null!=a){"string"==typeof a&&(a=a.split(""));for(b in a)e=i[b],f=a[b],i!==f&&(l&&f&&(d.hash(f)||(g=d.array(f)))?(g?(g=!1,h=e&&d.array(e)?e:[]):h=e&&d.hash(e)?e:{},i[b]=c(l,h,f)):"undefined"!=typeof f&&(i[b]=f))}return i}var d=a("is");c.version="1.0.8",b.exports=c},{is:6}],6:[function(a,b){var c=Object.prototype,d=c.hasOwnProperty,e=c.toString,f=function(a){return a!==a},g={"boolean":1,number:1,string:1,undefined:1},h=/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/,i=/^[A-Fa-f0-9]+$/,j=b.exports={};j.a=j.type=function(a,b){return typeof a===b},j.defined=function(a){return"undefined"!=typeof a},j.empty=function(a){var b,c=e.call(a);if("[object Array]"===c||"[object Arguments]"===c||"[object String]"===c)return 0===a.length;if("[object Object]"===c){for(b in a)if(d.call(a,b))return!1;return!0}return!1},j.equal=function(a,b){var c=a===b;if(c)return!0;var d,f=e.call(a);if(f!==e.call(b))return!1;if("[object Object]"===f){for(d in a)if(!(j.equal(a[d],b[d])&&d in b))return!1;for(d in b)if(!(j.equal(a[d],b[d])&&d in a))return!1;return!0}if("[object Array]"===f){if(d=a.length,d!==b.length)return!1;for(;--d;)if(!j.equal(a[d],b[d]))return!1;return!0}return"[object Function]"===f?a.prototype===b.prototype:"[object Date]"===f?a.getTime()===b.getTime():c},j.hosted=function(a,b){var c=typeof b[a];return"object"===c?!!b[a]:!g[c]},j.instance=j["instanceof"]=function(a,b){return a instanceof b},j.nil=j["null"]=function(a){return null===a},j.undef=j.undefined=function(a){return"undefined"==typeof a},j.args=j.arguments=function(a){var b="[object Arguments]"===e.call(a),c=!j.array(a)&&j.arraylike(a)&&j.object(a)&&j.fn(a.callee);return b||c},j.array=function(a){return"[object Array]"===e.call(a)},j.args.empty=function(a){return j.args(a)&&0===a.length},j.array.empty=function(a){return j.array(a)&&0===a.length},j.arraylike=function(a){return!!a&&!j["boolean"](a)&&d.call(a,"length")&&isFinite(a.length)&&j.number(a.length)&&a.length>=0},j["boolean"]=function(a){return"[object Boolean]"===e.call(a)},j["false"]=function(a){return j["boolean"](a)&&Boolean(Number(a))===!1},j["true"]=function(a){return j["boolean"](a)&&Boolean(Number(a))===!0},j.date=function(a){return"[object Date]"===e.call(a)},j.element=function(a){return void 0!==a&&"undefined"!=typeof HTMLElement&&a instanceof HTMLElement&&1===a.nodeType},j.error=function(a){return"[object Error]"===e.call(a)},j.fn=j["function"]=function(a){var b="undefined"!=typeof window&&a===window.alert;return b||"[object Function]"===e.call(a)},j.number=function(a){return"[object Number]"===e.call(a)},j.infinite=function(a){return 1/0===a||a===-1/0},j.decimal=function(a){return j.number(a)&&!f(a)&&!j.infinite(a)&&a%1!==0},j.divisibleBy=function(a,b){var c=j.infinite(a),d=j.infinite(b),e=j.number(a)&&!f(a)&&j.number(b)&&!f(b)&&0!==b;return c||d||e&&a%b===0},j["int"]=function(a){return j.number(a)&&!f(a)&&a%1===0},j.maximum=function(a,b){if(f(a))throw new TypeError("NaN is not a valid value");if(!j.arraylike(b))throw new TypeError("second argument must be array-like");for(var c=b.length;--c>=0;)if(a<b[c])return!1;return!0},j.minimum=function(a,b){if(f(a))throw new TypeError("NaN is not a valid value");if(!j.arraylike(b))throw new TypeError("second argument must be array-like");for(var c=b.length;--c>=0;)if(a>b[c])return!1;return!0},j.nan=function(a){return!j.number(a)||a!==a},j.even=function(a){return j.infinite(a)||j.number(a)&&a===a&&a%2===0},j.odd=function(a){return j.infinite(a)||j.number(a)&&a===a&&a%2!==0},j.ge=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!j.infinite(a)&&!j.infinite(b)&&a>=b},j.gt=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!j.infinite(a)&&!j.infinite(b)&&a>b},j.le=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!j.infinite(a)&&!j.infinite(b)&&b>=a},j.lt=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!j.infinite(a)&&!j.infinite(b)&&b>a},j.within=function(a,b,c){if(f(a)||f(b)||f(c))throw new TypeError("NaN is not a valid value");if(!j.number(a)||!j.number(b)||!j.number(c))throw new TypeError("all arguments must be numbers");var d=j.infinite(a)||j.infinite(b)||j.infinite(c);return d||a>=b&&c>=a},j.object=function(a){return"[object Object]"===e.call(a)},j.hash=function(a){return j.object(a)&&a.constructor===Object&&!a.nodeType&&!a.setInterval},j.regexp=function(a){return"[object RegExp]"===e.call(a)},j.string=function(a){return"[object String]"===e.call(a)},j.base64=function(a){return j.string(a)&&(!a.length||h.test(a))},j.hex=function(a){return j.string(a)&&(!a.length||i.test(a))}},{}],7:[function(a,b){var c=a("check-types"),d={debug:3,max_components_count:100,max_frame_time:20,time_factor:1,default_fps:60,ids_to_reuse_pool_size:1e3,initial_components_pool_size:1e3,initial_entities_pool_size:1e3},e={};b.exports=function(a,b){if(!c.not.unemptyString(a))if(null==b){if(a in e)return e[a];if(a in d)return d[a]}else e[a]=b}},{"check-types":2}],8:[function(a,b){"use strict";var c=a("check-types"),d=a("../debug");b.exports=function(a,b){return c.not.unemptyString(a)?void d.warn("constans key should be non-empty string"):(a=a.toUpperCase(),a in this?void d.warn("cannot define same constans twice: %s".key):(Object.defineProperty(this,a,{value:b}),b))}},{"../debug":20,"check-types":2}],9:[function(a,b){"use strict";function c(a){l.call(this),this.game=a,this._greatestEntityID=0,this._idsToReuse=new m(e("ids_to_reuse_pool_size")),this._systems=[],this._entities=f.alloc(1e4),this._modifiedEntities=f.alloc(1e4),this._modifiedEntitiesLength=0,this._entitiesToAdd=new m(1e3),this._entitiesToRemove=new m(1e3),this._systemsToAdd=new m(1e3),this._systemsToRemove=new m(1e3),this._entitiesPool={},this._componentsPool={},this._queries=[],this._entitiesCount=0,i.setCannotModify(),i.listComponentsNames().forEach(function(a){this._componentsPool[a]=new m(e("initial_components_pool_size"))},this),i.listEntitiesNames().forEach(function(a){this._entitiesPool[a]=new m(e("initial_entities_pool_size"))},this)}var d=a("node.extend"),e=a("../config"),f=a("./fastarray"),g=a("check-types"),h=a("../debug"),i=a("./register"),j=Array.prototype.slice,k=a("./query"),l=a("./event"),m=a("./pool"),n=a("./entity");c.Component=function(a){i.registerComponent(a)},c.Entity=function(a){i.registerEntity(a)},c.System=function(a){i.registerSystem(a)},c.Query=k,d(c.prototype,l.prototype),d(c.prototype,{create:function(a){if(g.not.unemptyString(a))return h.warn("entity name must be a string"),this;var b=i.getEntityPattern(a);if(g.not.object(b))return h.warn("entity pattern for %s does not exist",a),this;var c=j.call(arguments,1);c.unshift(this.game);var d=this._entitiesPool[a].get();return d=d||new n(a,b,this),b.create.apply(d,c),this._entitiesToAdd.put(d),this},remove:function(a){return null==a?this:(this._entitiesToRemove.put(a),this)},getAllEntities:function(){},getEntities:function(a){return-1===this._queries.indexOf(a)&&this._initializeQuery(a),a.entities},addSystem:function(a){var b,c;if(g.array(a)){if(2!==a.length)return h.warn("To add system with priority you must provide an array with two elements - [systemName, priority] - as a first parameter."),this;b=a[0],c=a[1]}else{if(!g.unemptyString(a))return h.warn("First argument for addSystem method must be either system name or array with system name and desired priority."),this;b=a}var e=i.getSystemPattern(b);if(g.not.object(e))return h.warn("There is no system %s.",a),this;if(e.singleton)for(var f=0,j=this._systems.length;j>f;f++)if(this._systems[f].name===e.name)return h.info("System you want to add is a singleton and there is one already present in the engine. Returning..."),this;var k=Array.prototype.slice.call(arguments,1);null==c&&(c=g.number(e.priority)?e.priority:0);var l=d(!0,{},e);return l.priority=c,g["function"](l.initialize)&&l.initialize.apply(l,k),l.engine=this,l.game=this.game,this._systemsToAdd.put(l),this},removeSystem:function(a){return null==a?(h.warn("System to remove has to be an object."),this):void this._systemsToRemove.put(a)},enableSystem:function(a){null!=a&&(a._disabled=!1)},disableSystem:function(a){null!=a&&(a._disabled=!0)},markModifiedEntity:function(a){0!==a.id&&-1===f.indexOf(this._modifiedEntities,this._modifiedEntitiesLength,a.id)&&f.push(this._modifiedEntities,this._modifiedEntitiesLength++,a.id)},clear:function(){},update:function(a){var b,c,d,e,i,j,k,l,m,n,o=a.delta,p=this._queries,q=this._entities,r=this._modifiedEntities;for(b=0,d=this._systems.length;d>b;b++)e=this._systems[b],e._disabled||e.update(o);for(var s;s=this._entitiesToRemove.get();){for(b=0,d=this._queries.length;d>b;b++)n=p[b],n.satisfiedBy(s)&&(k=n.index,l=f.indexOf(k,n.indexLength,s.id),-1!==l&&(n.touched=!0,f.removeAtIndexConst(k,n.indexLength--,l)));g["function"](s.pattern.remove)&&s.pattern.remove.call(s,this.game),q[s.id]=0,s.id=0,j=s.name,this._entitiesPool[j].put(s),this._entitiesCount-=1}for(var t;t=this._entitiesToAdd.get();){for(i=this._generateEntityID(),i>q.length&&f.extend(q,Math.round(1.25*q.length)),t.id=i,q[i]=t,b=0,d=this._queries.length;d>b;b++)n=p[b],n.satisfiedBy(t)&&(n.touched=!0,f.push(n.index,n.indexLength++,i));this._entitiesCount+=1}b=0;for(var u;u=q[r[b]];){for(u.applyModifications(),c=0,d=this._queries.length;d>c;c++){n=p[c],k=n.index,m=n.indexLength;var v=n.satisfiedBy(u),l=f.indexOf(k,m,u.id);v&&-1===l?(n.touched=!0,f.push(k,n.indexLength++,u.id)):v||-1===l||(n.touched=!0,f.removeAtIndexConst(k,n.indexLength--,l))}b++}f.clear(this._modifiedEntities,this._modifiedEntitiesLength),this._modifiedEntitiesLength=0;for(var w;w=this._systemsToRemove.get();){var x=this._systems.indexOf(w);-1!==x?(g["function"](w.remove)&&w.remove(),f.removeAtIndex(this._systems,x)):h.warn("Nothing to remove.")}for(var y;y=this._systemsToAdd.get();){var z=0,A=y.priority;for(d=this._systems.length;d>z&&!(this._systems[z].priority>A);z++);this._systems.splice(z,0,y)}for(b=0,d=this._queries.length;d>b;b++)if(n=p[b],n.touched){var k=n.index,B=n.entities,C=0;for(b=0;i=k[b];)f.push(B,C++,q[i]),b+=1;f.push(B,C,0),n.entitiesLength=C,n.touched=!1}},_getNewComponent:function(a){var b,c=i.getComponentPattern(a);return g.not.object(c)?null:(b=this._componentsPool[a].get(),null==b?b={_pattern:c}:g["function"](b._pattern.reset)&&b._pattern.reset.call(b),b)},_addComponentToPool:function(a){this._componentsPool[a._pattern.name].put(a)},_generateEntityID:function(){var a=this._idsToReuse.get();return null==a&&(a=++this._greatestEntityID),a},_initializeQuery:function(a){for(var b,c=f.alloc(1e3),e=0,g=f.alloc(1e3),h=0,i=0,j=this._greatestEntityID;j>i;i++){if(b=c[i],0===b)return;a.satisfiedBy(b)&&(f.push(g,h++,b.id),f.push(c,e++,b))}d(a,{entities:c,entitiesLength:e,index:g,indexLength:h,touched:!1}),this._queries.push(a)}}),b.exports=c},{"../config":7,"../debug":20,"./entity":10,"./event":11,"./fastarray":12,"./pool":15,"./query":16,"./register":17,"check-types":2,"node.extend":4}],10:[function(a,b){"use strict";function c(a,b,c){j.call(this),this.engine=c,this.pattern=b,this.bitset=new k(g("max_components_count")),this._modifications=[],this.id=0,this.name=a,this.components={},this._setDefaults()}var d=a("check-types"),e=a("../debug"),f=a("node.extend"),g=a("../config"),h=a("./register"),i=Array.prototype.slice,j=a("./event"),k=a("bitset.js").BitSet;f(c.prototype,j.prototype),f(c.prototype,{add:function(a){if(d.not.unemptyString(a))return e.warn("component name must be a non-empty string"),this;var b=a.toLowerCase(),c=this.engine._getNewComponent(b);if(null==c)return e.warn("there is no component pattern with name %s",a),this;var f=i.call(arguments,1);return c._pattern.initialize.apply(c,f),this.components[b]=c,this._modifications.push({fn:function(){this.bitset.set(h.getComponentID(b))}}),this.engine.markModifiedEntity(this),this},remove:function(a){if(d.not.unemptyString(a))return e.warn("component name must be a non-empty string"),this;var b=a.toLowerCase();return b in this.components?(this._modifications.push({fn:function(){this.engine._addComponentToPool(this.components[b]),this.components[b]=null,this.bitset.clear(h.getComponentID(b))}}),this.engine.markModifiedEntity(this),this):(e.warn('this entity does not have such component "%s" - nothing to remove',a),this)},get:function(a){return d.not.unemptyString(a)?(e.warn("component name must be a non-empty string"),this):this.components[a.toLowerCase()]},reset:function(){return d["function"](this._pattern.reset)&&this.pattern.reset.call(this,this.engine.game),this._setDefaults(),this},applyModifications:function(){for(var a;a=this._modifications.shift();)a.fn.apply(this,a.args)},clearModifications:function(){for(;this._modifications.shift(););},_setDefaults:function(){this._inFinalState=!1,this._remainingStateChanges=[],this._stateObject={},this._currentStates=[],this._stateChanges=[]}}),b.exports=c},{"../config":7,"../debug":20,"./event":11,"./register":17,"bitset.js":1,"check-types":2,"node.extend":4}],11:[function(a,b){"use strict";function c(){this.events={}}var d=a("check-types"),e=a("node.extend"),f=Array.prototype.slice;e(c.prototype,{on:function(a,b,c,e){d.not.string(a)||d.not["function"](b)||(this.events[a]=this.events[a]||[],this.events[a].push({fn:b,binding:c,once:e}))},once:function(a,b,c){this.on(a,b,c,!0)},emit:function(a){if(a in this.events)for(var b,c=f.call(arguments,1),d=0,e=this.events[a];d<e.length;){b=this.events[a][d];var g=b.fn.apply(b.binding,c);if(g===!1||b.once){for(var h=d;h<e.length;)e[h]=e[++h];e.length--}else d++}},trigger:function(){this.emit.apply(this,arguments)},off:function(a,b){!d.not.string(a)&&a in this.events&&(this.events[a]=this.events[a].filter(function(a){return d["function"](b)&&a.fn!==b}))}}),b.exports=c},{"check-types":2,"node.extend":4}],12:[function(a,b){b.exports={alloc:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=0;return b},extend:function(a,b){var c=a.length;a.length=c+b;for(var d=c,e=a.length;e>d;d++)a[d]=0;return a},removeAtIndex:function(a,b){var c=a.length;if(0!==c){for(;c>b;)a[b]=a[++b];a.length--}},removeAtIndexConst:function(a,b,c){if(0!==b){for(;b-1>c;)a[c]=a[++c];a[b-1]=0}},indexOf:function(a,b,c){for(var d=0;b>d;d++)if(a[d]===c)return d;return-1},clear:function(a,b){for(var c=0;b>c;c++)a[c]=0},push:function(a,b,c){b===a.length&&this.extend(a,Math.round(1.5*a.length)),a[b]=c}}},{}],13:[function(a,b){"use strict";function c(a){g.call(this),this.engine=new i(this),this.state=h(l,this),this.container=new j,this.ticker=new k(this),this.ticker.on("tick",this.engine.update,this.engine),this.state.change(a)}var d=a("check-types"),e=a("../debug"),f=a("node.extend"),g=a("./event"),h=a("./state"),i=a("./engine"),j=a("inverse"),k=a("./ticker"),l={};c.State=function(a){return d.object(a)?("transitions"in a||(a.transitions={}),a._initialized=!1,a.manager=this,void(l[a.name]=a)):e.warn("Registered state must be an object.")},f(c.prototype,g.prototype),f(c.prototype,{start:function(){return this.ticker.start()},stop:function(){return this.ticker.stop()},pause:function(){return this.ticker.pause()},resume:function(){return this.ticker.resume()}}),b.exports=c},{"../debug":20,"./engine":9,"./event":11,"./state":18,"./ticker":19,"check-types":2,inverse:3,"node.extend":4}],14:[function(){!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}()},{}],15:[function(a,b){function c(a){this._maxSize=a,this._currentSize=0,this._pool=new Array(a);for(var b=0;a>b;b++)this._pool[b]=0}var d=a("node.extend");d(c.prototype,{put:function(a){if(this._currentSize===this._maxSize){this._maxSize=Math.round(1.5*this._currentSize),this._pool.lenght=this._maxSize;for(var b=this._currentSize+1;b<this._maxSize;b++)this._pool[b]=0}this._pool[++this._currentSize]=a},get:function(){return 0===this._currentSize?null:this._pool[this._currentSize--]},size:function(){return this._currentSize}}),b.exports=c},{"node.extend":4}],16:[function(a,b){"use strict";function c(a){var b,c,h=[],j=[];if(d.array(a)?h=a:d.object(a)&&(d.array(a.include)&&(h=a.include),d.array(a.exclude)&&(j=a.exclude)),0===h.lenght&&0===j.lenght)return void e.warn("You want to create empty query. If your intention is to get all entities, use getAllEntities() instead.");if(h.lenght>0){b=new i(f("max_component_count"));for(var k=0;k<h.lenght;k++)b.set(g.getComponentID(h[k]))}if(j){c=new i(f("max_component_count"));for(var l=0;l<j.lenght;l++)c.set(g.getComponentID(j[k]))}this.include=b,this.excludes=c}var d=a("check-types"),e=a("../debug"),f=a("../config"),g=a("./register"),h=a("node.extend"),i=a("bitset.js").BitSet;h(c.prototype,{satisfiedBy:function(a){var b=!0,c=this.includes,d=this.excludes;return null!=c&&(b=c.subsetOf(a.bitset)),null!=d&&(b=b&&d.and(a.bitset).isEmpty()),b}}),b.exports=c},{"../config":7,"../debug":20,"./register":17,"bitset.js":1,"check-types":2,"node.extend":4}],17:[function(a,b){"use strict";var c=a("check-types"),d=a("../debug"),e=(a("../config"),!0),f={},g={},h={},i=0;b.exports={registerComponent:function(a){return e?c.not.object(a)?(d.error("component pattern must be an object"),!1):"name"in a&&"initialize"in a?a.name in f?(d.error("you can't define same component twice"),!1):(a._bit=i++,f[a.name.toLowerCase()]=a,!0):(d.error('you must define both "name" and "initialize" of component pattern'),!1):(d.error("you can't define new component during system work"),!1)},registerSystem:function(a){return e?c.object(a)?"name"in a&&"update"in a?a.name in g?(d.error("you can't define same system twice"),!1):(g[a.name]=a,!0):(d.error('you must define both "name" and "update" of system pattern'),!1):(d.error("system pattern must be an object"),!1):(d.error("you can't define new system during system work"),!1)},registerEntity:function(a){return e?c.not.object(a)?(d.error("entity pattern must be an object"),!1):"name"in a&&"create"in a?a.name in h?(d.error("you can't define same entity twice"),!1):(h[a.name]=a,!0):(d.error('you must define both "name" and "create" of entity pattern'),!1):(d.error("you can't define new system during system work"),!1)},listComponentsNames:function(){return Object.keys(f)},listEntitiesNames:function(){return Object.keys(h)},getComponentPattern:function(a){return f[a.toLowerCase()]},getComponentID:function(a){return f[a.toLowerCase()]._bit},getSystemPattern:function(a){return g[a]},getEntityPattern:function(a){return h[a]},canModify:function(){return e},setCannotModify:function(){e=!1}}},{"../config":7,"../debug":20,"check-types":2}],18:[function(a,b){"use strict";var c=a("check-types"),d=Array.prototype.slice;b.exports=function(a,b){var e=[],f={transitions:{}},g=!1,h=function(){var a=e.shift();if(null==a)return void(g=!1);g=!0;var b=a.fn,c=a.binding,d=a.args||[];d.push(i),b.apply(c,d)},i=function(){h()},j=function(a,b){return f=a,b()},k=function(a,b){return a._initialized=!0,b()},l=function(a,d){return c["function"](a.initialize)?a.initialize(b,d):d()},m=function(a,d){return c["function"](a.enter)?a.enter(b,d):d()},n=function(a){return c["function"](f.exit)?f.exit(b,a):a()},o=function(a,c){var e=d.call(arguments,2);if(a in f.transitions){var g=f[f.transitions[a]];return g.apply(f,[b,c].concat(e))}var h=e.pop();return h()};return{change:function(b){if(!(c.string(b)&&b in a))return void console.warn("State %s does not exists - change will not occur.",b);var f=d.call(arguments,1),i=a[b];return e.push({fn:n}),i._initialized||(e.push({fn:l,args:[i]}),e.push({fn:k,args:[i]})),e.push({fn:o,args:[b,i].concat(f)}),e.push({fn:m,args:[i]}),e.push({fn:j,args:[i]}),g?void 0:h()},current:function(){return f.name},isIn:function(a){return a===f.name},feed:function(a){return this.register(a)},register:function(b){return c.object(b)?("transitions"in b||(b.transitions={}),b._initialized=!1,b.manager=this,a[b.name]=b,this):console.warn("Registered state must be an object.")}}}},{"check-types":2}],19:[function(a,b){(function(c){"use strict";function d(a,b){i.call(this),this.game=a,this.TIME_FACTOR=g("time_factor"),this.MAX_FRAME_TIME=g("max_frame_time"),this._loopVariant=b,this._paused=!1,this._running=!1,this._ticks=0,this._currentFPS=0,this._rafID=0,this._debug=!1}var e=c.requestAnimationFrame,f=a("node.extend"),g=a("../config"),h=a("../lib/stats"),i=a("./event");f(d.prototype,i.prototype),f(d.prototype,{getCurrentFPS:function(){return this._currentFPS},getTicks:function(){return this._ticks},setTimeFactor:function(a){this.TIME_FACTOR=a},pause:function(){return!this.isRunning()||this.isPaused()?!1:(this._paused=!0,this.emit("pause"),!0)},resume:function(){return this.isRunning()&&this.isPaused()?(this._paused=!1,this.emit("resume"),!0):!1},start:function(){function a(){b._rafID=e(a);var f=performance.now(),g=f-c;b._paused||(b._ticks+=1,g>=b.MAX_FRAME_TIME&&(g=b.MAX_FRAME_TIME),d.delta=g*b.TIME_FACTOR,d.ticks=b._ticks,b._debug&&b._stats.begin(),b.emit("tick",d),b._debug&&b._stats.end())}var b=this;if(this.isPaused())return this.resume();if(this.isRunning())return!1;var c=performance.now(),d={};this._rafID=e(a),this._running=!0,this.emit("start")},stop:function(){return 0===this._rafID?!1:(c.cancelAnimationFrame(this._rafID),this._running=this._paused=!1,this.emit("stop"),!0)},isPaused:function(){return this._paused},isRunning:function(){return this._running},debug:function(a){null==this._stats&&(this._stats=new h),a?(this._stats.domElement.style.position="absolute",this._stats.domElement.style.right="0px",this._stats.domElement.style.top="0px",document.body.appendChild(this._stats.domElement),this._debug=!0):(document.body.removeChild(this._stats.domElement),this._debug=!1)}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../config":7,"../lib/stats":22,"./event":11,"node.extend":4}],20:[function(a,b){"use strict";var c=a("../config");b.exports={log:function(){c("debug")>=3&&console.log.apply(console,arguments)},warn:function(){c("debug")>=2&&console.warn.apply(console,arguments)},error:function(){c("debug")>=1&&console.error.apply(console,arguments)}}},{"../config":7}],21:[function(a,b){"use strict";function c(){d.warning("This function should not be used as a constructor.")}a("./core/polyfill");var d=a("./debug"),e=(a("./config"),a("./core/const")),f=a("./core/game"),g=a("./core/engine");console.log.apply(console,["%c %c %c Entropy 0.2.0 - Entity System Framework for JavaScript %c %c ","background: rgb(200, 200,200);","background: rgb(80, 80, 80);","color: white; background: black;","background: rgb(80, 80, 80);","background: rgb(200, 200, 200);"]),c.Const=function(a,b){return e.call(this,a,b)},c.Game=f,c.Engine=g,b.exports=c},{"./config":7,"./core/const":8,"./core/engine":9,"./core/game":13,"./core/polyfill":14,"./debug":20}],22:[function(a,b){var c=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";
var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}};"object"==typeof b&&(b.exports=c)},{}]},{},[21])(21)});
//# sourceMappingURL=entropy.map.js