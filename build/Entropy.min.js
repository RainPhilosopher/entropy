/*! entropy 2014-01-15 */

!function(a){function b(a){return"string"==typeof a||a instanceof String}var c,d="0.1",e={getVersion:function(){return"v"+d}};a.Entropy=c=e,function(a){a.Easing={Linear:{In:function(a,b,c,d){return c*a/d+b}},Quadratic:{In:function(a,b,c,d){return a/=d,c*a*a+b},Out:function(a,b,c,d){return a/=d,-c*a*(a-2)+b},InOut:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)}},Cubic:{In:function(a,b,c,d){return a/=d,c*a*a*a+b},Out:function(a,b,c,d){return a/=d,a--,c*(a*a*a+1)+b},InOut:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b)}},Quartic:{In:function(a,b,c,d){return a/=d,c*a*a*a*a+b},Out:function(a,b,c,d){return a/=d,a--,-c*(a*a*a*a-1)+b},InOut:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a+b:(a-=2,-c/2*(a*a*a*a-2)+b)}},Quintic:{In:function(a,b,c,d){return a/=d,c*a*a*a*a*a+b},Out:function(a,b,c,d){return a/=d,a--,c*(a*a*a*a*a+1)+b},InOut:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a*a+b:(a-=2,c/2*(a*a*a*a*a+2)+b)}},Sine:{In:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},Out:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},InOut:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}},Exponential:{In:function(a,b,c,d){return c*Math.pow(2,10*(a/d-1))+b},Out:function(a,b,c,d){return c*(-Math.pow(2,-10*a/d)+1)+b},InOut:function(a,b,c,d){return a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:(a--,c/2*(-Math.pow(2,-10*a)+2)+b)}},Circular:{In:function(a,b,c,d){return a/=d,-c*(Math.sqrt(1-a*a)-1)+b},Out:function(a,b,c,d){return a/=d,a--,c*Math.sqrt(1-a*a)+b},InOut:function(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:(a-=2,c/2*(Math.sqrt(1-a*a)+1)+b)}}}}(c),function(a){function c(b){g=!1,this.game=b,this._greatest_e_id=0,this._e_ids_to_reuse=[],this._entities=[],this._current_e_id=null,this._entities_count=0,this._components_index=[],this._components_pool=[],this._components_pool_size=0,this._entities_pool={},this._entities_pool_size=0,this._systems=new a.OrderedLinkedList,this._updating=!1,this._families={none:new a.Family("none")},this._entity_family_index=[],this._entities_to_remove=[],this._blank_family=new a.Family("empty");for(var c=0;h>c;c+=1)this._components_pool[c]=[]}var d={},e={},f={},g=!0,h=0;c.component=function(b,c){g||a.Game.error("Entropy: you can't specify components during system work - do it before initialization."),"string"==typeof b||b instanceof String||a.Game.error("Entropy: component name should be string."),"object"!=typeof c&&a.Game.error("Entropy: component should be plain object."),"undefined"!=typeof d[b]&&a.Game.error("Entropy: you can't specify same component twice."),d[b]=[h,c],h+=1},c.system=function(b,c){g||a.Game.error("Entropy: you can't specify systems during system work - do it before initialization."),"string"==typeof b||b instanceof String||a.Game.error("Entropy: system name should be string."),"object"!=typeof c&&a.Game.error("Entropy: system should be plain object."),"undefined"!=typeof e[b]&&a.Game.error("Entropy: you can't specify same system twice."),"update"in c||a.Game.error("Entropy: system should specify 'update' method."),e[b]=c},c.entity=function(a,b,c){f[a]={families:b.split("|"),pattern:c}},c.prototype={getComponentPattern:function(a){return d[a][1]},getNewComponent:function(a){var b=d[a][0];if(this._components_pool[b].length>0){this._components_pool_size-=1;var c=this._components_pool[b].pop();return c.deleted=!1,c}return{id:b,name:a,deleted:!1}},addComponentToPool:function(a,b){var c=d[a][0];return this._components_pool_size+=1,this._components_pool[c].push(b)},setComponentsIndex:function(a,b){this._components_index[a][b]=!0},unsetComponentsIndex:function(a,b){this._components_index[a][b]=!1},canModify:function(){return g},create:function(b){var c,d,e,g,h,i,j;for(arguments.length>1?(j=Array.prototype.slice.call(arguments,1),j.unshift(this.game)):j=[this.game],0!==this._e_ids_to_reuse.length?c=this._e_ids_to_reuse.pop():(c=this._greatest_e_id,this._greatest_e_id+=1,this._components_index[c]=this._components_index[c]||[]),this._entities_pool[b]=this._entities_pool[b]||[],this._entities_pool[b].length>0?(d=this._entities_pool[b].pop(),d.setId(c),d.setRecycled(),this._entities_pool_size-=1):(this._entities_pool[b]=[],d=new a.Entity(c,b,this.game)),f[b].pattern.create.apply(d,j),this._entities[c]=d,e=f[b].families,h=e.length,g=0;h>g;g+=1)i=e[g],this._families.hasOwnProperty(i)||(this._families[i]=new a.Family(i)),this._families[i].append(d);this._entity_family_index[c]=e,this._entities_count+=1},remove:function(a){var b,c,d,e,g=a.id,h=f[a.name].families;if("undefined"!=typeof this._entities[g]){for(arguments.length>1?(b=Array.prototype.slice.call(arguments,2),b.unshift(this.game)):b=[this.game],d=h.length,c=0;d>c;c+=1)e=h[c],this._families[e].remove(a);f[a.name].pattern.remove&&f[a.name].pattern.remove.apply(a,b),a.removeAllComponents(!0),this._components_index[g].length=0,this._entities_pool[a.name].push(a),this._entities_pool_size+=1,delete this._entities[g],this._e_ids_to_reuse.push(g),this._entities_count-=1}},removeAllEntities:function(){},markForRemoval:function(a){this._entities_to_remove.push(a)},getEntity:function(a){return"undefined"!=typeof this._entities[a]?this._entities[a]:null},getEntitiesWith:function(a){var b,c,e,f,g,h,i=[];for(a=a.map(function(a){return d[a][0]}),c=this._components_index.length,f=0;c>f;f+=1){for(h=0,e=a.length,b=0;e>b;b+=1)g=a[b],this._components_index[f][g]&&(h+=1);h===a.length&&i.push(this._entities[f])}return i},getAllEntities:function(){return this._entities.map(function(a){return a})},getFamily:function(c){return b(c)||a.Game.error("family name must be a string."),this._families.hasOwnProperty(c)?this._families[c]:this._blank_family},addSystem:function(a,b){var c=Array.prototype.slice.call(arguments,2),d=e[a];return d.game=this.game,d.engine=this,d._name=a,d.init&&d.init.apply(d,c),this._systems.insert(d,b),this},removeSystem:function(a){return this.isUpdating()||this._systems.remove(a),this},removeAllSystems:function(){this._systems.clear()},isSystemActive:function(a){for(var b=this._systems.head;b;){if(b.data._name===a)return!0;b=b.next}return!1},update:function(a,b){this._updating=!0;for(var c=this._systems.head;c;)c.data.update(a,b),c=c.next;for(c=this._systems.head;c;)c.data.afterUpdate&&c.data.afterUpdate(a,b),c=c.next;for(var d=0,e=this._entities_to_remove.length;e>d;d++)this.remove(this._entities_to_remove[d]);this._entities_to_remove.length=0,this._updating=!1},clear:function(){},isUpdating:function(){return this._updating},getComponentPoolSize:function(){return this._component_pool_size}},a.Engine=c}(c),function(a){function b(a,b,c){this.id=a,this.name=b,this.engine=c.engine,this.game=c,this.components={},this.recycled=!1,this.states={"default":{onEnter:function(){},onExit:function(){}}},this.current_state="default"}var c=b.prototype;c.add=function(b){var c=[];arguments.length>1&&(c=Array.prototype.slice.call(arguments,1));var d=b.toLowerCase(),e=this.engine.getComponentPattern(b);return this.components.hasOwnProperty(d)?this.recycled||a.Game.warning(" you are trying to add same component twice. Existing component will be overridden."):this.components[d]=this.engine.getNewComponent(b),e.init.apply(this.components[d],c),this.engine.setComponentsIndex(this.id,this.components[d].id),this},c.remove=function(a,b){var c=a.toLowerCase();if(b&&this.components[c].deleted)return this;if(this.components.hasOwnProperty(c)){{this.engine.getComponentPattern(a)}b?this.components[c].deleted=!0:(this.engine.addComponentToPool(a,this.components[c]),delete this.components[c]),this.engine.unsetComponentsIndex(this.id,this.components[c].id)}return this},c.removeAllComponents=function(a){for(var b in this.components)this.remove(this.components[b].name,a);return this},c.setId=function(a){this.id=a},c.setRecycled=function(){this.recycled=!0},c.addState=function(b,c){return this.states.hasOwnProperty(b)?a.Game.warning("such state already exists."):this.states[b]=c,this},c.state=function(a){var b=[];return arguments.length>1&&(b=Array.prototype.slice.call(arguments,1)),this.states[this.current_state].onExit.apply(this.states[this.current_state],b),this.current_state=a,this},a.Entity=b}(c),function(a){function b(a){this.data=a,this.next=null}function c(a){this.name=a,this.head=this.tail=null,this.break_iteration=!1}c.prototype={append:function(a){var c=new b(a);null===this.head?(this.head=c,this.tail=this.head):null===this.head.next?(this.head.next=c,this.tail=this.head.next):(this.tail.next=c,this.tail=c)},remove:function(a){var b=this.findPrecedingNode(a);if(-1!==b){var c=b.next;b.next=b.next.next,c=null}},findPrecedingNode:function(c){for(var d=this.head;d;){if(c instanceof b){if(d.next===c)return d}else{if(!(c instanceof a.Entity))return-1;if(null!==d.next&&d.next.data===c)return d}d=d.next}return-1},iterate:function(a,b){b=b||function(){return this}();for(var c=this.head;c&&(a.call(b,c.data,c.data.components,c,this),!this.break_iteration);)c=c.next;this.break_iteration=!1},breakIteration:function(){this.break_iteration=!0},one:function(){return this.head.data}},a.Family=c}(c),function(a){function b(b){this.input=new a.Input(this),this.engine=new a.Engine(this),this.ticker=new a.Ticker(this),this.ticker.addListener(this.engine,this.engine.update),this.changeState(b)}_consts={};var c={dummy:{onEnter:function(){},onReturn:function(){},onExit:function(){}}},d="dummy",e={},f={};b.addState=function(a,d){"string"!=typeof a&&b.error("state name should be type of string."),c[a]=d},b.entityPattern=function(a,c,d){3!==arguments.length&&b.error("wrong number of arguments for ent. pattern."),f[a]={family:c,pattern:d}},b.log=function(a){console.log("Entropy: ",a)},b.error=function(a){throw new Error(["Entropy: ",a].join(" "))},b.warning=function(a){console.warn("Entropy: ",a)},b.constans=function(a,c){("string"!=typeof a||""===a)&&b.error("constans name should be non-empty string."),a=a.toUpperCase(),b.hasOwnProperty(a)?b.error("can't define same constans twice."):Object.defineProperty(b,a,{value:c})},b.prototype={changeState:function(a){"string"==typeof a&&a in c||b.error("no such state or state name not a string.");var f=Array.prototype.slice.call(arguments,1);f.unshift(this),c[d].onExit.apply(c[d],f),a in e?(d=a,c[a].onReturn.apply(c[a],f)):(d=a,c[a].onEnter.apply(c[a],f),e[a]=!0),console.log(d)},setRenderer:function(a){this.renderer=a},setStage:function(a){this.stage=a},create:function(a){var b=Array.prototype.slice.call(arguments,1);return this.engine.createEntity(f[a].family),f[a].pattern.create.apply(this.engine,b)},start:function(){this.ticker.start(),b.log("Game starded!")},pause:function(){this.ticker.pause(),b.log("Game paused!")},resume:function(){this.ticker.resume(),b.log("Game resumed!")}},a.Game=b}(c),function(a){function b(a){this.game=a;for(var b=0;256>b;b++)d[b]=!1;window.addEventListener("keydown",function(a){d[a.keyCode]=!0}),window.addEventListener("keyup",function(a){d[a.keyCode]=!1})}var c={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,"CAPS_LOCK ":20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},d=[],e={x:0,y:0};b.prototype={isPressed:function(a){return d[c[a]]},getPressedKeys:function(){var a={};for(var b in c)a[b]=d[c[b]];return a},setMouseStagePosition:function(a){e=a},getMouseStagePosition:function(){return e}},a.Input=b}(c),function(a){function b(){this.head=this.tail=null}var c=function(a){return{next:null,priority:null,data:a}};b.prototype={append:function(a){return this.insert(a)},remove:function(a){if(a===this.head)return this.head=this.head.next,this;for(var b=this.head;b.next!==a;)b=b.next;return b.next=a.next,a===this.tail&&(this.tail=b),a=null,this},insert:function(a,b){var d=c(a);if(null===this.head)return d.priority=b||0,this.head=this.tail=d,this;var e=this.head;if(d.priority=b||this.tail.priority,null===e.next)return e.priority<=d.priority?(e.next=d,this.tail=e.next):(this.head=d,this.head.next=this.tail=e),this;if(d.priority>=this.tail.priority)return this.tail.next=d,this.tail=d,this;if(d.priority<this.head.priority)return d.next=this.head,this.head=d,this;for(;null!==e.next;){if(e.next.priority>d.priority){d.next=e.next,e.next=d;break}e=e.next}return this},iterate:function(a){for(var b=this.head;b;b=b.next)a(this,b)},clear:function(){this.head=this.tail=null}},a.OrderedLinkedList=b}(c),function(a){function b(){this.head=this.tail=null}var c=function(a){return{next:null,priority:null,data:a}};b.prototype={append:function(a){return this.insert(a)},remove:function(a){if(a===this.head)return this.head=this.head.next,this;for(var b=this.head;b.next!==a;)b=b.next;return b.next=a.next,a===this.tail&&(this.tail=b),a=null,this},insert:function(a,b){var d=c(a);if(null===this.head)return d.priority=b||0,this.head=this.tail=d,this;var e=this.head;if(d.priority=b||this.tail.priority,null===e.next)return e.priority<=d.priority?(e.next=d,this.tail=e.next):(this.head=d,this.head.next=this.tail=e),this;if(d.priority>=this.tail.priority)return this.tail.next=d,this.tail=d,this;if(d.priority<this.head.priority)return d.next=this.head,this.head=d,this;for(;null!==e.next;){if(e.next.priority>d.priority){d.next=e.next,e.next=d;break}e=e.next}return this},iterate:function(a){for(var b=this.head;b;b=b.next)a(this,b)},clear:function(){this.head=this.tail=null}},a.OrderedLinkedList=b}(c),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(){if("undefined"==typeof window.performance&&(window.performance={}),!window.performance.now){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}(),function(a){function b(a){this.game=a}function c(a){if(i(c),f)return k=!1,void 0;a=a||performance.now();var b=a-j;b>=e&&(b=1e3/d),j=a,m.delta=b,m.ticks=g,m.paused=f;for(var l=0,n=h.length;n>l;l++)h[l][1].call(h[l][0],b,m);g++}var d=60,e=1e3/d*2,f=!1,g=0,h=[],i=window.requestAnimationFrame,j=0,k=!1,l=0,m={};b.prototype={setFPS:function(a){d=a||d},getFPS:function(){return d},getTicks:function(){return g},pause:function(){f=!0},resume:function(){f&&!k&&(k=!0,f=!1)},addListener:function(a,b){h.push([a,b])},start:function(){l=i(c)}},a.Ticker=b}(c),function(a){function b(a){return a*Math.PI/180}function c(a){return 180*a/Math.PI}var d=function(a){if("[object Array]"===Object.prototype.toString.call(a))this.x=a[0],this.y=a[1],this.updatePolarCoords();else{if("object"!=typeof a)throw new Error("Podałeś zły format współrzędnych!");"undefined"==typeof a.x?(this.angle=0,this.rotate(a.angle),this.length=a.length,this.updateCartCoords()):(this.x=a.x,this.y=a.y,this.updatePolarCoords())}},e=d.prototype;e.rotate=function(a,b){return a%=360,b=b||!1,b?new d({length:this.length,angle:this.angle+a}):(this.angle+=a,this.angle%=360,this.updateCartCoords(),this)},e.rotateRad=function(a,b){return a%=2*Math.PI,b=b||!1,b?new d({length:this.length,angle:this.angle+c(a)}):(this.rotate(c(a)),this)},e.add=function(a,b){b=b||!1;var c,e;if("[object Array]"===Object.prototype.toString.call(a))c=a[0],e=a[1];else{if("object"!=typeof a)throw new Error("Zły parametr.");c=a.x,e=a.y}return b?new d([this.x+c,this.y+e]):(this.x+=c,this.y+=e,this.updatePolarCoords(),this)},e.scale=function(a,b){return(b=b||!1)?new d([this.x*a,this.y*a]):(this.x*=a,this.y*=a,this.updatePolarCoords(),this)},e.setAngle=function(a,b){return b=b||!1,b?new d({length:this.length,angle:a}):(this.angle=0,this.rotate(a),this)},e.getRadAngle=function(){return b(this.angle)},e.truncate=function(a,b){return(b=b||!1)?new d({angle:this.angle,length:a}):(this.length=a,this.updateCartCoords(),this)},e.normalize=function(a){return this.truncate(1,a)},e.substract=function(a,b){b=b||!1;var c,e;if("[object Array]"===Object.prototype.toString.call(a))c=a[0],e=a[1];else{if("object"!=typeof a)throw new Error("Zły parametr.");c=a.x,e=a.y}return b?new d([this.x-c,this.y-e]):(this.x-=c,this.y-=e,this.updatePolarCoords(),this)},e.dot=function(a){var b;if("[object Array]"===Object.prototype.toString.call(a))b=this.x*a[0]+this.y*a[1];else{if("object"!=typeof a)throw new Error("Zły parametr.");b=this.x*a.x+this.y*a.y}return b},e.reverseX=function(a){return(a=a||!1)?new d([-this.x,this.y]):(this.x=-this.x,this.updatePolarCoords(),void 0)},e.reverseY=function(a){return(a=a||!1)?new d([this.x,-this.y]):(this.y=-this.y,this.updatePolarCoords(),void 0)},e.reverseBoth=function(a){return(a=a||!1)?new d([-this.x,-this.y]):(this.x=-this.x,this.y=-this.y,this.updatePolarCoords(),this)},e.minAngleTo=function(a){this.angle<0&&(this.angle+=360),a.angle<0&&(a.angle+=360);var b=a.angle-this.angle;return b>180?b=360+this.angle-a.angle:-180>b&&(b=360-this.angle+a.angle),b},e.negate=function(a){return this.reverseBoth(a)},e.clone=function(){return new d([this.x,this.y])},e.updatePolarCoords=function(){this.length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),this.angle=0,this.rotate(c(Math.atan2(this.y,this.x)+2*Math.PI))},e.updateCartCoords=function(){this.x=Math.cos(b(this.angle))*this.length,this.y=Math.sin(b(this.angle))*this.length},e.debug=function(){return"x: "+this.x+", y: "+this.y+", angle: "+this.angle+", length: "+this.length},a.Vector=d}(c)}(this);
//# sourceMappingURL=build/entropy.map.js