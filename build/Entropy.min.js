/*! Entropy 2013-12-25 */
!function(a){var b,c="0.1",d={getVersion:function(){return"v"+c}};a.Entropy=b=d,function(a){function b(){f=!1,this._greatest_e_id=0,this._e_ids_to_reuse=[],this._entities=[],this._current_e_id=null,this._components=[],this._component_pool=[],this._component_pool_size=0,this._nodes={},this._systems=new a.OrderedLinkedList,this._updating=!1;for(var b=0;g>b;b++)this._component_pool[b]=[]}var d={},e={},f=!0,g=0;b.component=function(a,b){if(!f)throw new Error("Entropy: you can't specify components during system work - do it before initialization.");if("string"!=typeof a&&!(a instanceof String))throw new Error("Entropy: component name should be string.");if("object"!=typeof b)throw new Error("Entropy: component should be plain object.");if("undefined"!=typeof d[a])throw new Error("Entropy: you can't specify same component twice.");d[a]=[g,b],g+=1},b.system=function(a,b){if(!f)throw new Error("Entropy: you can't specify systems during system work - do it before initialization.");if("string"!=typeof a&&!(a instanceof String))throw new Error("Entropy: system name should be string.");if("object"!=typeof b)throw new Error("Entropy: system should be plain object.");if("undefined"!=typeof e[a])throw new Error("Entropy: you can't specify same system twice.");if(!("init"in b&&"update"in b))throw new Error("Entropy: system should specify 'init' and 'update' methods.");e[a]=b},b.node=function(){},b.prototype={canModify:function(){return f},createEntity:function(){if(0!==this._e_ids_to_reuse.length)var a=this._e_ids_to_reuse.pop();else{var a=this._greatest_e_id++;this._entities[a]=[],this._components[a]=[];for(var b=0;b<this._next_c_id;b++)this._entities[a][b]=!1,this._components[a][b]=!1}return this._current_e_id=a,a},removeEntity:function(a){for(var b=0;b<this._entities[a].length;b++)if(this._entities[a][b]){this._entities[a][b]=!1;var c=(this._components[a][b]._name,b);this._component_pool[c].push(this._components[a][b]),this._component_pool_size++,this._components[a][b]=!1}return this._e_ids_to_reuse.push(a),this},add:function(a,b){if("number"==typeof a)var c=Array.prototype.slice.call(arguments,2);else{var b=a;a=this._current_e_id;var c=Array.prototype.slice.call(arguments,1)}var e=d[b][0];if(0!==this._component_pool[e].length){var f=this._component_pool[e].pop();this._component_pool_size--}else var f={};return this._entities[a][e]=!0,this._components[a][e]=d[b][1].init.apply(f,c),this},remove:function(){},getComponents:function(a){for(var b=[],c=0,e=a.length;e>c;c++)a[c]=d[a[c]][0];for(var f=0,e=this._entities.length;e>f;f++){for(var g=[],h=0,i=a.length;i>h;h++)this._entities[f][a[h]]&&g.push(this._components[f][a[h]]);g.length===a.length&&b.push(g.slice(0))}return b},addSystem:function(a,b){var c=Array.prototype.slice.call(arguments,2),d=e[a];return d._core=this,d._name=a,d.init.apply(d,c),this._systems.insert(d,b),this},removeSystem:function(a){this.isUpdating()||this._systems.remove(a)},isSystemActive:function(a){for(var b=this._systems.head;b;){if(b.data._name===a)return!0;b=b.next}return!1},update:function(a){this._updating=!0;for(var b=this._systems.head;b;b=b.next)b.data.update(a);this._updating=!1},isUpdating:function(){return this._updating},getComponentPoolSize:function(){return this._component_pool_size},getVersion:function(){return"v"+c}},a.Engine=b}(b),function(a){function b(b){this.input=new a.Input,this.engine=new a.Engine,this.ticker=new a.Ticker,this.ticker.addListener(this.engine,this.engine.update),this.changeState(b)}_consts={};var c={dummy:{onEnter:function(){},onReturn:function(){},onExit:function(){}}},d="dummy",e={};b.addState=function(a){if("string"!=typeof a)throw new Error("Entropy: ")},b.prototype={constans:function(a,b){if("string"!=typeof a||""===a)throw new Error("Entropy: constans name should be non-empty string.");if(a in _consts){if("undefined"==typeof b)return _consts[a];throw new Error("Entropy: can't define same constans twice.")}return _consts[a]=b,!0},changeState:function(a){if("string"!=typeof a||!(a in c))throw new Error("Entropy: no such state or state name not a string.");var b=Array.prototype.slice.call(arguments,1);return b.unshift(this),c[d].onExit.apply(c[d],b),a in e?c[a].onReturn.apply(c[a],b):(c[a].onEnter.apply(c[a],b),e[a]=!0),d=a,!0},log:function(a){console.log(a)},start:function(){this.ticker.start()},pause:function(){},stop:function(){}},a.Game=b}(b),function(a){function b(){for(var a=0;256>a;a++)d[a]=!1;window.addEventListener("keydown",function(a){d[a.keyCode]=!0}),window.addEventListener("keyup",function(a){d[a.keyCode]=!1})}var c={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,"CAPS_LOCK ":20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F1:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},d=[];b.prototype={isPressed:function(a){return d[c[a]]},getPressedKeys:function(){var a={};for(var b in c)a[b]=d[c[b]];return a}},a.Input=b}(b),function(a){function b(){this.head=this.tail=null}var c=function(a){return{next:null,priority:null,data:a}};b.prototype={append:function(a){return this.insert(a)},remove:function(a){if(a===this.head)return this.head=this.head.next,this;for(var b=this.head;b.next!==a;)b=b.next;return b.next=a.next,a===this.tail&&(this.tail=b),a=null,this},insert:function(a,b){var d=c(a);if(null===this.head)return d.priority=b||0,this.head=this.tail=d,this;var e=this.head;if(d.priority=b||this.tail.priority,null===e.next)return e.priority<=d.priority?(e.next=d,this.tail=e.next):(this.head=d,this.head.next=this.tail=e),this;if(d.priority>=this.tail.priority)return this.tail.next=d,this.tail=d,this;if(d.priority<this.head.priority)return d.next=this.head,this.head=d,this;for(;null!==e.next;){if(e.next.priority>d.priority){d.next=e.next,e.next=d;break}e=e.next}return this},iterate:function(){for(var a=this.head;a;a=a.next);}},a.OrderedLinkedList=b}(b),function(a){function b(){}function c(a){if(g)return l=!1,void 0;if(!h)var a=a||(new Date).getTime();var b=a-k;b>=f&&(b=1e3/e),k=a,i%e===0&&(m=Math.round(1e3/b)),n.delta=b,n.ticks=i,n.paused=g;for(var o=0,p=j.length;p>o;o++)j[o][1].call(j[o][0],n);i++,h&&d(c,e)}var d,e=60,f=1e3/e*2,g=!1,h=!0,i=0,j=[],k=0,l=!1,m=e,n={};b.prototype={useRAF:function(a){h=a},currentFPS:function(){return Math.round(m)},setFPS:function(a){e=a||e},getFPS:function(){return e},getTicks:function(){return i},pause:function(){g=!0,h||window.clearInterval(d)},resume:function(){g&&!l&&(l=!0,g=!1,h?c():d(c,e))},addListener:function(a,b){j.push([a,b])},start:function(){d=h?function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/b)}}():function(a,b){return window.setInterval(a,1e3/b)},l=!0,d(c)}},a.Ticker=b}(b)}(this);