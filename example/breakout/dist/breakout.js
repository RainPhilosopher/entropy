!function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){var t=document.querySelector(e);return Velocity(t,{opacity:0},{display:"none",duration:500})}function a(e,t){var n=document.querySelector(e);return Velocity(n,{opacity:1},{display:"block",duration:500})}function i(e,t,n){return n=n||"0",e+="",e.length>=t?e:new Array(t-e.length+1).join(n)+e}function s(e,t,n){return e<t?t:e>n?n:e}var r=[],l=n(1);l.keys().forEach(function(e){r.push(l(e))});var d=[],c=n(13);c.keys().forEach(function(e){d.push(c(e))});var m=[],u=n(22);u.keys().forEach(function(e){m.push(u(e))});var p=[],y=n(27);y.keys().forEach(function(e){p.push(y(e))}),window.addEventListener("load",function(){Entropy.registerPlugin(EntropyStatePlugin),Entropy.registerPlugin(EntropyLoaderPlugin),Entropy.registerPlugin(EntropyAnimationPlugin);var e=Entropy();window.game=e,e.registerComponents(m),e.registerEntities(d),e.registerSystems(r),p.forEach(function(t){e.state.define(t)}),a(".loading-screen").then(function(){e.state.change("Loading")})}),window.fadeOutScreen=o,window.fadeInScreen=a,window.pad=i,window.clamp=s},function(e,t,n){function o(e){return n(a(e))}function a(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./AnimationUpdater":2,"./AnimationUpdater.js":2,"./BallDeathChecker":3,"./BallDeathChecker.js":3,"./BlockHit":4,"./BlockHit.js":4,"./CountdownSystem":5,"./CountdownSystem.js":5,"./InitializeLevel":6,"./InitializeLevel.js":6,"./LevelChanger":7,"./LevelChanger.js":7,"./PaddleHit":8,"./PaddleHit.js":8,"./PaddleMovement":9,"./PaddleMovement.js":9,"./PhysicsStep":10,"./PhysicsStep.js":10,"./Renderer":11,"./Renderer.js":11,"./SpriteBodyUpdater":12,"./SpriteBodyUpdater.js":12};o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id=1},function(e,t){"use strict";e.exports={type:"AnimationUpdater",onCreate:function(){this.query=this.game.createQuery(["Animation"])},onUpdate:function(e,t){for(var n,o=this.game.getEntities(this.query),a=0;n=o.entities[a];)n.components.animation.animation.update(e),a++}}},function(e,t){"use strict";e.exports={type:"BallDeathChecker",onCreate:function(){this.query=this.game.createQuery({entityType:"Ball"}),this.playerQuery=this.game.createQuery({entityType:"Player"})},onUpdate:function(e,t){for(var n,o=this,a=this.game.getEntities(this.query),i=this.game.getEntities(this.playerQuery).entities[0],s=0,r=0;n=a.entities[r];)n.components.body.body.position[1]<-22&&(this.game.removeEntity(n),s++),r++;s===r&&0!==r&&(i.components.stats.lives--,i.components.stats.lives===-1?(console.log("Wszystko stracone."),this.game.engine.clear(),this.game.engine.once("clear",function(){o.game.stop(),o.game.state.change("GameOver")})):(i.components.stats.livesTextNode.text="life:"+i.components.stats.lives,this.game.addEntity("Ball",-8,0,11,-11),this.game.addEntity("Counter"),this.game.addSystem("CountdownSystem"),this.game.removeSystem("PhysicsStep")))}}},function(e,t){"use strict";e.exports={type:"BlockHit",onCreate:function(){var e=this.game.createQuery({entityType:"Block"}),t=this.game.createQuery({entityType:"Player"}),n=this,o=this.game,a=function(a){if("ball"===a.bodyA.entId&&"block"===a.bodyB.entId)var i=(a.bodyA,a.bodyB);else{if("block"!==a.bodyA.entId||"ball"!==a.bodyB.entId)return;var i=(a.bodyB,a.bodyA)}if(i.collisionResponse!==!1){for(var a,s,r=n.game.getEntities(t).entities[0],l=n.game.getEntities(e),d=l.length,c=0;a=l.entities[c];){if(a.components.body.body===i){s=a;break}c++}if(null!=s){var m=s.components.animation.animation;r.components.stats.score+=100,r.components.stats.scoreTextNode.text="score:"+pad(r.components.stats.score,4),i.collisionResponse=!1,o.SOUND_CACHE.brickDeath.play(),m.play(),m.onComplete=function(){if(1===d){var e=++r.components.stats.level;e<=2?n.game.addSystem("InitializeLevel",e):(n.game.engine.clear(),n.game.engine.once("clear",function(){n.game.stop(),n.game.state.change("GameOver")}))}n.game.removeEntity(s)}}}};this.handleBlockHit=a,this.game.world.on("beginContact",a)},onUpdate:function(e,t){},remove:function(){this.game.world.off("beginContact",this.handleBlockHit)}}},function(e,t){"use strict";e.exports={type:"CountdownSystem",onCreate:function(){this.counterQuery=this.game.createQuery({entityType:"Counter"}),this.hasRun=!1},onUpdate:function(e,t){var n=this;if(!this.hasRun){var o=this.game.getEntities(this.counterQuery).entities[0],a=o.components.animation.animation;a.onComplete=function(){n.game.removeEntity(o),n.game.addSystem("PhysicsStep"),n.game.removeSystem(n)},a.play(),game.SOUND_CACHE.countdownBlip.play(),this.hasRun=!0}}}},function(e,t){"use strict";e.exports={type:"InitializeLevel",singleton:!0,onCreate:function(e){this.blocksQuery=this.game.createQuery({entityType:"Block"}),this.ballQuery=this.game.createQuery({entityType:"Ball"}),this.playerQuery=this.game.createQuery({entityType:"Player"}),this.counterQuery=this.game.createQuery({entityType:"Counter"}),this.level=game.levels[e-1],this.hasRun=!1},onUpdate:function(e,t){if(!this.hasRun){var n=this.game.getEntities(this.ballQuery).entities[0],o=this.game.getEntities(this.counterQuery).entities[0],a=this.game.getEntities(this.playerQuery).entities[0],i=this.game.getEntities(this.blocksQuery);this.game.removeSystem("PhysicsStep"),n&&this.game.removeEntity(n),o&&this.game.removeEntity(o);for(var s,r=0;s=i.entities[r];)this.game.removeEntity(s),r++;for(var l=3.2*this.level.blocks[0].length,d=-l/2+1.6,c=15,m=0;m<this.level.blocks.length;m++)for(var i=this.level.blocks[m],u=0;u<i.length;u++){var p=i[u];"X"!==p&&this.game.addEntity("Block",d+3.2*u,c-1.6*m,game.colorMap[p])}game.addEntity("Ball",-8,0,11,-11),game.addEntity("Counter"),game.addSystem("CountdownSystem"),a.components.stats.levelTextNode.text="lvl:"+a.components.stats.level,this.hasRun=!0,this.game.removeSystem(this)}}}},function(e,t){"use strict";e.exports={type:"LevelChanger",onCreate:function(){var e=this,t=this.game.createQuery({entityType:"Player"});this.handleLevelChange=function(n){var o=e.game.getEntities(t).entities[0];if(o&&o.components&&o.components.stats){var a;if(37===n.keyCode){if(a=o.components.stats.level-1,a<1)return}else{if(39!==n.keyCode)return;if(a=o.components.stats.level+1,a>2)return}o.components.stats.level=a,e.game.addSystem("InitializeLevel",a)}},window.addEventListener("keyup",this.handleLevelChange)},onUpdate:function(e,t){},remove:function(){window.removeEventListener("keyup",this.handleLevelChange)}}},function(e,t){"use strict";e.exports={type:"PaddleHit",onCreate:function(){this.game.world.on("beginContact",this.handlePaddleHit)},handlePaddleHit:function(e){if("ball"===e.bodyA.entId&&"paddle"===e.bodyB.entId){var t=e.bodyA;e.bodyB}else{if("paddle"!==e.bodyA.entId||"ball"!==e.bodyB.entId)return;var t=e.bodyB;e.bodyA}if(e.contactEquations[0].normalA[1]===-1){var n=p2.vec2.length(t.velocity),o=p2.vec2.create();p2.vec2.copy(o,e.contactEquations[0].contactPointB),p2.vec2.add(o,o,[0,1]),p2.vec2.normalize(o,o);var a=1,i=Math.atan2(o[1],o[0]),s=Math.PI/8;i>6*s||i<2*s?a=1.1:i>5*s||i<3*s?a=1.05:i<5*s&&i>3*s&&(a=.95),p2.vec2.scale(o,o,clamp(n*a,11,16)),t.velocity=o}},onUpdate:function(e,t){},remove:function(){this.game.world.off("beginContact",this.handlePaddleHit)}}},function(e,t){"use strict";e.exports={type:"PaddleMovement",onCreate:function(){var e=this.game.stage,t={x:0};this.mousePosition=t,e.on("mousemove",function(n){t.x=e.toLocal(n.data.global).x}),this.query=this.game.createQuery({entityType:"Paddle"})},onUpdate:function(e,t){var n=this.game.getEntities(this.query).entities[0],o=n.components.body.body,a=-(Entropy.WIDTH/Entropy.ZOOM/2)+o.shapes[0].width/2,i=Entropy.WIDTH/Entropy.ZOOM/2-o.shapes[0].width/2,s=this.mousePosition.x;s<a&&(s=a),s>i&&(s=i),o.position[0]=s}}},function(e,t){"use strict";e.exports={type:"PhysicsStep",onUpdate:function(e,t){this.game.world.step(1/60,e,2)}}},function(e,t){"use strict";e.exports={type:"Renderer",onCreate:function(){this.stage=this.game.stage,this.renderer=this.game.renderer},onUpdate:function(e,t){this.renderer.render(this.stage)}}},function(e,t){"use strict";e.exports={type:"SpriteBodyUpdater",onCreate:function(){this.query=this.game.createQuery(["Sprite","Body"]),this.queryAnimations=this.game.createQuery(["Animation","Body"])},onUpdate:function(e,t){for(var n,o=this.game.getEntities(this.query),a=this.game.getEntities(this.queryAnimations),i=0;n=o.entities[i];){var s=n.components.sprite.sprite,r=n.components.body.body;s.position.x=r.position[0],s.position.y=r.position[1],i++}for(var i=0;n=a.entities[i];){var l=n.components.animation.animation,r=n.components.body.body;l.position.x=r.position[0],l.position.y=r.position[1],i++}}}},function(e,t,n){function o(e){return n(a(e))}function a(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./Ball":14,"./Ball.js":14,"./Block":15,"./Block.js":15,"./Counter":16,"./Counter.js":16,"./Paddle":17,"./Paddle.js":17,"./Player":18,"./Player.js":18,"./WallLeft":19,"./WallLeft.js":19,"./WallRight":20,"./WallRight.js":20,"./WallTop":21,"./WallTop.js":21};o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id=13},function(e,t){"use strict";e.exports={type:"Ball",onCreate:function(e,t,n,o,a){var i=[1,2,3,4,5].map(function(e){return PIXI.utils.TextureCache["ball_0"+e+".png"]}),s=new p2.Body({mass:1,position:[e,t],angle:0,velocity:[n,o],angularVelocity:0,damping:0,angularDamping:0});s.entId="ball";var r=new p2.Circle({radius:.8});r.material=game.materials.ballMaterial,s.addShape(r),this.game.world.addBody(s);var l=new PIXI.extras.AnimatedSprite(i);l.position.x=e,l.position.y=t,l.anchor.x=.5,l.anchor.y=.5,l.scale.y=-1/Entropy.ZOOM,l.scale.x=1/Entropy.ZOOM,l.loop=!0,this.game.stage.addChild(l),l.play(),this.addComponent("Animation",l).addComponent("Body",s)},onRemove:function(){game.world.removeBody(this.components.body.body),game.stage.removeChild(this.components.animation.animation)}}},function(e,t){"use strict";e.exports={type:"Block",onCreate:function(e,t,n,o){var a=new p2.Body({mass:0,position:[e,t],angle:0});a.entId="block";var i=new p2.Box({height:1.6,width:3.2});i.material=game.materials.wallMaterial,a.addShape(i),game.world.addBody(a);var s=[1,2,3,4,5].map(function(e){return PIXI.utils.TextureCache[n+"_0"+e+".png"]}).reverse(),r=this.game.animation.create(s);r.standardFrameDuration=100,r.loop=!1,r.position.x=e,r.position.y=t,r.anchor.x=.5,r.anchor.y=.5,r.scale.y=-1/Entropy.ZOOM,r.scale.x=1/Entropy.ZOOM,game.stage.addChild(r),r.onComplete=function(){},r.play(),this.addComponent("Animation",r).addComponent("Body",a)},onRemove:function(){game.stage.removeChild(this.components.animation.animation),game.world.removeBody(this.components.body.body)}}},function(e,t){"use strict";e.exports={type:"Counter",onCreate:function(){var e=[{texture:PIXI.utils.TextureCache["num_3.png"],time:1e3},{texture:PIXI.utils.TextureCache["num_2.png"],time:1e3},{texture:PIXI.utils.TextureCache["num_1.png"],time:1e3}],t=this.game.animation.create(e);t.amiationSpeed=1,t.loop=!1,t.position.x=0,t.position.y=0,t.anchor.x=.5,t.anchor.y=.5,t.scale.y=-1/Entropy.ZOOM,t.scale.x=1/Entropy.ZOOM,game.stage.addChild(t),t.onFrameChange=function(){game.SOUND_CACHE.countdownBlip.play()},this.addComponent("Animation",t)},onRemove:function(){var e=this.components.animation.animation;game.stage.removeChild(e)}}},function(e,t){"use strict";e.exports={type:"Paddle",onCreate:function(e){var t=new p2.Body({mass:0,position:[0,-16.8],angle:0,dumping:0});t.entId="paddle";var n=new p2.Box({height:1.6,width:4.8});n.material=game.materials.wallMaterial,t.addShape(n),game.world.addBody(t);var o=new PIXI.Sprite(PIXI.utils.TextureCache["pad_big.png"]);o.position.x=t.position[0],o.position.y=t.position[1],o.anchor.x=.5,o.anchor.y=.5,o.scale.y=-1/Entropy.ZOOM,o.scale.x=1/Entropy.ZOOM,game.stage.addChild(o),this.addComponent("Sprite",o).addComponent("Body",t)},onRemove:function(){game.stage.removeChild(this.components.sprite.sprite),game.world.removeBody(this.components.body.body)}}},function(e,t){"use strict";e.exports={type:"Player",onCreate:function(){var e=new PIXI.Text("life:3",{fontFamily:"Press Start 2P",fontSize:12}),t=new PIXI.Text("score:0000",{fontFamily:"Press Start 2P",fontSize:12}),n=new PIXI.Text("lvl:1",{fontFamily:"Press Start 2P",fontSize:12});e.position.x=-14,e.position.y=-18.7,e.scale.y=-1/Entropy.ZOOM,e.scale.x=1/Entropy.ZOOM,t.position.x=-5,t.position.y=-18.7,t.scale.y=-1/Entropy.ZOOM,t.scale.x=1/Entropy.ZOOM*.95,n.position.x=7.8,n.position.y=-18.7,n.scale.y=-1/Entropy.ZOOM,n.scale.x=1/Entropy.ZOOM*.95,game.stage.addChild(e),game.stage.addChild(t),game.stage.addChild(n),this.addComponent("Stats",0,e,t,n)},onRemove:function(){game.stage.removeChild(this.components.playerstats.livesTextNode),game.stage.removeChild(this.components.playerstats.scoreTextNode)}}},function(e,t){"use strict";e.exports={type:"WallLeft",onCreate:function(e){var t=new p2.Body({position:[-14.4,0],angle:-Math.PI/2}),n=new p2.Plane;n.material=game.materials.wallMaterial,t.addShape(n),game.world.addBody(t),this.addComponent("Body",t)}}},function(e,t){"use strict";e.exports={type:"WallRight",onCreate:function(e){var t=new p2.Body({position:[14.4,0],angle:Math.PI/2}),n=new p2.Plane;n.material=game.materials.wallMaterial,t.addShape(n),game.world.addBody(t),this.addComponent("Body",t)}}},function(e,t){"use strict";e.exports={type:"WallTop",onCreate:function(){var e=new p2.Body({position:[0,19.2],angle:Math.PI}),t=new p2.Plane;t.material=game.materials.wallMaterial,e.addShape(t),game.world.addBody(e),this.addComponent("Body",e)}}},function(e,t,n){function o(e){return n(a(e))}function a(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./Animation":23,"./Animation.js":23,"./Body":24,"./Body.js":24,"./Sprite":25,"./Sprite.js":25,"./Stats":26,"./Stats.js":26};o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id=22},function(e,t){"use strict";e.exports={type:"Animation",onCreate:function(e){this.animation=e}}},function(e,t){"use strict";e.exports={type:"Body",onCreate:function(e){this.body=e}}},function(e,t){"use strict";e.exports={type:"Sprite",onCreate:function(e){this.sprite=e}}},function(e,t){"use strict";e.exports={type:"Stats",onCreate:function(e,t,n,o){this.lives=null==e?3:e,this.score=0,this.level=1,this.livesTextNode=t,this.scoreTextNode=n,this.levelTextNode=o}}},function(e,t,n){function o(e){return n(a(e))}function a(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./GameOver":28,"./GameOver.js":28,"./Gameplay":29,"./Gameplay.js":29,"./Initialize":30,"./Initialize.js":30,"./Loading":31,"./Loading.js":31,"./Menu":32,"./Menu.js":32};o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id=27},function(e,t){"use strict";e.exports={name:"GameOver",onEnter:function(){return fadeInScreen(".gameover-screen")},onExit:function(){return fadeOutScreen(".gameover-screen")}}},function(e,t){"use strict";e.exports={name:"Gameplay",onInit:function(){this.gameplayScreen=document.querySelector(".gameplay-screen"),this.game.levels=[{blocks:["XXgogXX","obgggbo","XbbbbbX"],powerUps:1,powerDowns:1},{blocks:["XgogogX","XbbbbbX","gbrbrbg","gbbbbbg","gbXXXbg","XbbbbbX"],powerUps:1,powerDowns:1}],this.game.colorMap={o:"orange",b:"blue",g:"green",r:"red"}},onEnter:function(){var e=this;return this.game.materials={ballMaterial:new p2.Material,wallMaterial:new p2.Material},this.game.addSystem("Renderer",0),this.game.addSystem("AnimationUpdater",1),this.game.addSystem("SpriteBodyUpdater",2),this.game.addSystem("BlockHit",3),this.game.addSystem("PaddleHit",3),this.game.addSystem("PaddleMovement",3),this.game.addSystem("BallDeathChecker",3),this.game.addSystem("LevelChanger",3),this.game.addEntity("Player"),this.game.addEntity("Paddle"),this.game.addEntity("WallTop"),this.game.addEntity("WallRight"),this.game.addEntity("WallLeft"),this.game.world.addContactMaterial(new p2.ContactMaterial(this.game.materials.ballMaterial,this.game.materials.wallMaterial,{restitution:1,stiffness:Number.MAX_VALUE})),this.game.world.addContactMaterial(new p2.ContactMaterial(this.game.materials.ballMaterial,this.game.materials.ballMaterial,{restitution:1,stiffness:Number.MAX_VALUE})),this.game.addSystem("InitializeLevel",1),fadeInScreen(".gameplay-screen").then(function(){e.game.start()})},onExit:function(){return fadeOutScreen(".gameplay-screen")}}},function(e,t){"use strict";e.exports={name:"Initialize",onInit:function(){Entropy.WIDTH=320,Entropy.HEIGHT=416,Entropy.ZOOM=10;var e=document.querySelector(".game-canvas"),t=new PIXI.autoDetectRenderer(Entropy.WIDTH,Entropy.HEIGHT,{view:e,transparent:!0,antialias:!1}),n=new PIXI.Container,o=new PIXI.Container;n.addChild(o),o.position.x=Entropy.WIDTH/2,o.position.y=Entropy.HEIGHT/2,o.scale.x=Entropy.ZOOM,o.scale.y=-Entropy.ZOOM,o.interactive=!0,game.input={};var a=new p2.World({gravity:[0,0]});game.renderer=t,game.stage=o,game.world=a,game.state.change("Menu")}}},function(e,t){"use strict";e.exports={name:"Loading",onInit:function(){this.loadingScreen=document.querySelector(".loading-screen")},onEnter:function(){var e=(document.querySelector(".progress-bar-inner"),this.game.loader.loadPixiTextureAtlas({url:"./assets/textures/breakout.json"}).loadHowlerSound({name:"brickDeath",url:["./assets/sounds/brickDeath.ogg","./assets/sounds/brickDeath.mp3","./assets/sounds/brickDeath.wav"]}).loadHowlerSound({name:"countdownBlip",url:["./assets/sounds/countdownBlip.ogg","./assets/sounds/countdownBlip.mp3","./assets/sounds/countdownBlip.wav"]}));e.start(function(){game.state.change("Initialize")})},onExit:function(){return fadeOutScreen(".loading-screen")}}},function(e,t){"use strict";e.exports={name:"Menu",onInit:function(){this.menuScreen=document.querySelector(".menu-screen")},onEnter:function(){return this.startGameHandler=function(e){game.state.change("Gameplay")},this.menuScreen.addEventListener("click",this.startGameHandler),fadeInScreen(".menu-screen")},onExit:function(){return this.menuScreen.removeEventListener("click",this.startGameHandler),fadeOutScreen(".menu-screen")}}}]);